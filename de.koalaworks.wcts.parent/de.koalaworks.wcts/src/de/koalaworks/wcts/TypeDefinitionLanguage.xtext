grammar de.koalaworks.wcts.TypeDefinitionLanguage with org.eclipse.xtext.common.Terminals

import "http://www.eclipse.org/emf/2002/Ecore" as ecore

generate typeDefinitionLanguage "http://www.koalaworks.de/wcts/TypeDefinitionLanguage"

SiteStructure:
	(typeDefinitions+=Type)*;

Type:
	FeatureCapableType | ReferenceType;

FeatureCapableType:
	ContentType | PageType;

ContentType:
	'content' 'type' name=ID
	('is' 'recognized' 'by' selector=ContentSelector)?
	('recognize' (features+=Feature)+)?;

PageType:
	'page' 'type' name=ID
	'is' 'recognized' 'by' selector=PageSelector
	('recognize' (features+=Feature)+)?;

ReferenceType:
	'reference' 'type' name=ID
	('is' 'recognized' 'by' selector=ReferenceSelector)?;

ContentSelector:
	CssSelector | ScriptSelector | XPathSelector;

PageSelector:
	UrlPatternSelector;

ReferenceSelector:
	CssSelector | ScriptSelector | UrlPatternSelector | XPathSelector;

CssSelector:
	'css' definition=SELECTOR_VALUE;

ScriptSelector:
	'executing' definition=SELECTOR_VALUE;

UrlPatternSelector:
	'url' 'pattern' definition=SELECTOR_VALUE;

XPathSelector:
	'xpath' definition=SELECTOR_VALUE;

Feature:
	ScalarFeature | CollectionFeature;	

ScalarFeature:
	name=ID 'as' type=[FeatureType] ('by' selector=(FeatureSelector))?;	

CollectionFeature:
	name=ID 'as' 'many' type=[FeatureType] ('each' 'by' selector=(FeatureSelector))?;

FeatureType:
	ContentType | ReferenceType;

FeatureSelector:
	CssSelector | ScriptSelector | UrlPatternSelector | XPathSelector;

terminal SELECTOR_VALUE:
	'«' (!('\b' | '\f' | '\n' | '\r' | '\t' ))* '»';
